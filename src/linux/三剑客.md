# **三剑客**

## awk  - 文本处理语言
- **核心功能**：分析和处理结构化文本（如日志、CSV）。它不仅仅是命令，更是一门编程语言，能进行格式化和报告生成。它按列处理数据的能力非常突出。
- **名字由来**：取自三位创始人 Alfred Aho, Peter Weinberger, 和 Brian Kernighan 的姓氏首字母。
- **经典用法与概念** 
```
!/bin/bash

# 基本结构：awk ‘模式 {动作}’ 文件
# 打印 file.txt 的每一行的第一列和第三列（默认以空格为分隔符）
awk '{print $1, $3}' file.txt

# 指定分隔符（例如处理CSV文件）
awk -F, '{print $2}' data.csv # 使用逗号分隔
awk -F: '{print $1}' /etc/passwd # 使用冒号分隔

# 内置变量：
#   $0: 整行内容
#   $1, $2, ... $n: 第1, 2, ... n列
#   NF: 当前行的字段总数（列数）
#   NR: 当前处理的行号

# 打印最后一列
awk '{print $NF}' file.txt

# 打印文件的行数
awk 'END {print NR}' file.txt

# 条件判断：打印第一列大于100的行
awk '$1 > 100 {print $0}' data.txt

# 模式匹配：打印包含 "error" 的行（类似 grep）
awk '/error/ {print}' file.log

#  BEGIN 和 END 块：用于初始化和汇总
awk 'BEGIN {sum=0} {sum+=$1} END {print "Total: ", sum}' numbers.txt

# 使用逻辑运算符
awk '$1 == "admin" && $2 == "success" {print $3}' auth.log

```

## grep - 全球正则表达式搜索
- **核心功能**：**查找**和**过滤**。用于在文本中搜索匹配指定模式（字符串或正则表达式）的行。
- **名字由来**：global regular expression print
- **经典用法与选项**：

```
#!/bin/bash
# 基本搜索：在文件 file.txt 中搜索包含 "error" 的行
grep "error" file.log

# 忽略大小写
grep -i "error" file.log

# 递归搜索：在当前目录及其所有子目录的文件中搜索
grep -r "config" .

# 显示不匹配的行（反向选择）
grep -v "success" file.log

# 只显示匹配到的字符串（而不是整行），常与 -o 连用
grep -o "user-[0-9]*" file.log

# 显示匹配行的行号
grep -n "warning" file.log

# 使用扩展正则表达式（支持 +, ?, |, () 等，不需要转义）
grep -E "error|warning|critical" file.log
# 等同于 egrep "error|warning|critical" file.log

# 统计匹配到的行数
grep -c "404" access.log
```

## sed - 流编辑器
- **核心功能**：替换、删除、新增、选取文本。它以行为单位进行处理，尤其擅长批量替换。
- **名字由来**：stream editor
- **经典用法与选项**：

```
#!/bin/bash

# 最基本且最常用的功能：替换文本
# 将 file.txt 中所有的 "apple" 替换为 "orange"（只替换每行第一个匹配的）
sed 's/apple/orange/' file.txt

# 替换所有匹配项（全局替换），需要加 g 标志
sed 's/apple/orange/g' file.txt

# 直接修改原文件（非常危险！操作前建议备份）
sed -i 's/apple/orange/g' file.txt

# 删除空白行
sed '/^$/d' file.txt

# 删除包含 "debug" 的行
sed '/debug/d' file.txt

# 只打印第 10 到 20 行
sed -n '10,20p' file.txt

# 在每一行的行首添加内容（如添加一个时间戳占位符）
sed 's/^/[TIMESTAMP] /' file.log

# 多重操作：先替换，再删除空行
sed -e 's/apple/orange/g' -e '/^$/d' file.txt
```


## 三剑客合璧：经典组合示例
- 它们的强大之处在于可以通过管道 | 组合使用。


##### 场景1：分析 Nginx 访问日志 access.log，找出请求量最大的 5 个 IP 地址。
```
# 1. 使用 grep 过滤出所有访问行（可选，如果需要的话）
# 2. 使用 awk 提取第一列（IP地址）
# 3. 使用 sort 对 IP 进行排序，为 uniq 做准备
# 4. 使用 uniq -c 统计每个 IP 的出现次数
# 5. 使用 sort -nr 按统计次数倒序排序
# 6. 使用 head -5 取前5个

awk '{print $1}' access.log | sort | uniq -c | sort -nr | head -5
```

##### 场景2：替换一个配置文件中的内容，并注释掉原行。
```
# 将 config.conf 中所有 "ServerName old.domain.com" 的行
# 在原行上方添加一个新配置，并注释掉旧的行
sed -i '/ServerName old.domain.com/{
i\ServerName new.domain.com
a\#ServerName old.domain.com
d
}' config.conf
```