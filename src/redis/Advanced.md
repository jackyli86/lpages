ä¸‹é¢å…ˆæ¢³ç†ä¸‰ç§æ¨¡å¼çš„**ä¼˜åŠ¿ä¸åŒºåˆ«**ï¼Œå†ç»™å‡ºåœ¨**å±€åŸŸç½‘ç¯å¢ƒ**ä¸‹å¯ç›´æ¥å¥—ç”¨çš„éƒ¨ç½²ç¤ºä¾‹ï¼ˆå‡è®¾å±€åŸŸç½‘ç½‘æ®µä¸º `192.168.1.0/24`ï¼Œæ“ä½œç³»ç»Ÿ Linuxï¼Œå·²å®‰è£… Redis 7.xï¼‰ã€‚

---

## 1ï¸âƒ£ ä¸‰ç§æ¨¡å¼æ¦‚è§ˆ

| æ¨¡å¼                    | ç»“æ„                | ä¼˜åŠ¿                    | ä¸»è¦ä¸è¶³           | é€‚ç”¨åœºæ™¯           |
| --------------------- | ----------------- | --------------------- | -------------- | -------------- |
| **å‰¯æœ¬é›† (Replication)** | 1 ä¸» + N ä»         | ç®€å•ã€è¯»å†™åˆ†ç¦»ã€ä»èŠ‚ç‚¹å¯åšå†·å¤‡       | ä¸»å®•æœºéœ€äººå·¥åˆ‡æ¢ï¼Œå†™æ€§èƒ½å•ç‚¹ | è¯»å¤šå†™å°‘ã€å¯æ¥å—æ‰‹åŠ¨è¿ç»´   |
| **å“¨å…µ (Sentinel)**     | 1 ä¸» + N ä» + 3+ å“¨å…µ | è‡ªåŠ¨æ•…éšœè½¬ç§»ã€é«˜å¯ç”¨ã€å®¢æˆ·ç«¯å¯è‡ªåŠ¨å‘ç°æ–°ä¸» | ä»æ˜¯å•ä¸»å†™ï¼Œå®¹é‡å—é™     | ä¸­å°è§„æ¨¡ï¼Œè¦æ±‚è‡ªåŠ¨å®¹ç¾    |
| **é›†ç¾¤ (Cluster)**      | å¤šä¸»å¤šä»ï¼Œ16384 æ§½      | æ°´å¹³åˆ†ç‰‡ã€è¯»å†™éƒ½å¯æ‰©å±•ã€å»ä¸­å¿ƒåŒ–      | éƒ¨ç½²å¤æ‚ï¼Œä¸æ”¯æŒè·¨æ§½äº‹åŠ¡   | å¤§æ•°æ®é‡ã€é«˜ QPSã€é«˜å¯ç”¨ |

---

## 2ï¸âƒ£ å±€åŸŸç½‘éƒ¨ç½²ç¤ºä¾‹

ä»¥ä¸‹ IP ä»…ç¤ºä¾‹ï¼Œè¯·æ ¹æ®ä½ çš„å±€åŸŸç½‘å®é™…è°ƒæ•´ã€‚

### A. å‰¯æœ¬é›†ï¼ˆç®€å•ä¸»ä»ï¼‰

**ç›®æ ‡**ï¼š`192.168.1.10` ä¸ºä¸»ï¼Œ`192.168.1.11` ä¸ºä»ã€‚

1. **ä¸»èŠ‚ç‚¹** (`192.168.1.10`)
   `/etc/redis/redis.conf`

   ```conf
   bind 0.0.0.0
   port 6379
   protected-mode no
   ```

   å¯åŠ¨ï¼š

   ```bash
   redis-server /etc/redis/redis.conf
   ```

2. **ä»èŠ‚ç‚¹** (`192.168.1.11`)
   `/etc/redis/redis.conf`

   ```conf
   bind 0.0.0.0
   port 6379
   replicaof 192.168.1.10 6379
   ```

   å¯åŠ¨ï¼š

   ```bash
   redis-server /etc/redis/redis.conf
   ```

> å®¢æˆ·ç«¯è¯»å†™ä¸»åº“ï¼Œè¯»å‹åŠ›å¤§æ—¶å¯è¯»ä»åº“ã€‚ä¸»æŒ‚äº†éœ€æ‰‹å·¥æ‰§è¡Œ `replicaof no one` å°†ä»æå‡ä¸ºä¸»ã€‚

---

### B. å“¨å…µæ¨¡å¼

**ç›®æ ‡**ï¼šä¸»ä»ä¸ä¸Šé¢ä¸€è‡´ï¼Œå¤–åŠ  3 ä¸ª Sentinel èŠ‚ç‚¹ï¼ˆå¯ä¸ Redis èŠ‚ç‚¹åŒæœºä¸åŒç«¯å£ï¼‰ã€‚

* èŠ‚ç‚¹ç¤ºä¾‹ï¼š

  * Redis ä¸»ï¼š`192.168.1.10:6379`
  * Redis ä»ï¼š`192.168.1.11:6379`
  * Sentinelï¼š`192.168.1.10:26379`, `192.168.1.11:26379`, `192.168.1.12:26379`

**Sentinel é…ç½®ï¼ˆæ¯ä¸ªå“¨å…µç±»ä¼¼ï¼‰ï¼š**
`/etc/redis/sentinel.conf`

```conf
port 26379
sentinel monitor mymaster 192.168.1.10 6379 2
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 10000
sentinel auth-pass mymaster <password-if-any>
```

å¯åŠ¨ï¼š

```bash
redis-sentinel /etc/redis/sentinel.conf
```

* è‡³å°‘ 3 ä¸ªå“¨å…µï¼Œ`quorum` è®¾ç½®ä¸º 2ã€‚
* ä¸»èŠ‚ç‚¹æŒ‚æ‰åï¼Œå“¨å…µä¼šè‡ªåŠ¨æŠŠä»èŠ‚ç‚¹æå‡ä¸ºä¸»ï¼Œå¹¶é€šçŸ¥å®¢æˆ·ç«¯æ–°ä¸»åœ°å€ã€‚

---

### C. é›†ç¾¤æ¨¡å¼

**ç›®æ ‡**ï¼š6 èŠ‚ç‚¹ï¼Œ3 ä¸» 3 ä»ï¼ˆæœ€å°ç”Ÿäº§å»ºè®®ï¼‰ã€‚

* èŠ‚ç‚¹ï¼š

  ```
  192.168.1.21 7000
  192.168.1.22 7000
  192.168.1.23 7000
  192.168.1.24 7000
  192.168.1.25 7000
  192.168.1.26 7000
  ```

**æ¯ä¸ªèŠ‚ç‚¹é…ç½®ç¤ºä¾‹** `/etc/redis/7000.conf`

```conf
port 7000
cluster-enabled yes
cluster-config-file nodes-7000.conf
cluster-node-timeout 5000
appendonly yes
bind 0.0.0.0
```

å¯åŠ¨æ‰€æœ‰èŠ‚ç‚¹ï¼š

```bash
redis-server /etc/redis/7000.conf
```

åˆ›å»ºé›†ç¾¤ï¼š

```bash
redis-cli --cluster create \
192.168.1.21:7000 192.168.1.22:7000 192.168.1.23:7000 \
192.168.1.24:7000 192.168.1.25:7000 192.168.1.26:7000 \
--cluster-replicas 1
```

* `--cluster-replicas 1` è¡¨ç¤ºæ¯ä¸ªä¸»èŠ‚ç‚¹ä¸€ä¸ªä»èŠ‚ç‚¹ã€‚
* å®¢æˆ·ç«¯è¿æ¥ä»»æ„èŠ‚ç‚¹å³å¯è®¿é—®æ•´ä¸ªé›†ç¾¤ï¼Œæ•°æ®ä¼šæŒ‰ 16384 æ§½è‡ªåŠ¨åˆ†ç‰‡ã€‚

---

## 3ï¸âƒ£ é€‰æ‹©å»ºè®®

| éœ€æ±‚              | æ¨è       |
| --------------- | -------- |
| è¯»å¤šå†™å°‘ï¼Œäººå·¥åˆ‡æ¢å¯æ¥å—    | **å‰¯æœ¬é›†**  |
| é«˜å¯ç”¨ã€å†™é‡ä¸€èˆ¬ã€è¿ç»´ä¸­ç­‰   | **å“¨å…µæ¨¡å¼** |
| æ•°æ®é‡å¤§ã€å†™å‹åŠ›é«˜ã€éœ€æ°´å¹³æ‰©å±• | **é›†ç¾¤æ¨¡å¼** |

---

### ğŸ”‘ æ€»ç»“

* **å‰¯æœ¬é›†**ï¼šéƒ¨ç½²æœ€ç®€å•ï¼Œä»…è¯»æ‰©å±•ã€‚
* **å“¨å…µæ¨¡å¼**ï¼šåœ¨å‰¯æœ¬é›†ä¸ŠåŠ **è‡ªåŠ¨æ•…éšœè½¬ç§»**ï¼Œæ˜¯ä¸­å°ä¼ä¸šé«˜å¯ç”¨çš„å¸¸è§æ–¹æ¡ˆã€‚
* **é›†ç¾¤æ¨¡å¼**ï¼šçœŸæ­£çš„**å¤šä¸»åˆ†ç‰‡ + é«˜å¯ç”¨**ï¼Œé€‚åˆæµ·é‡æ•°æ®å’Œé«˜å¹¶å‘ã€‚
  ä»¥ä¸Šå±€åŸŸç½‘å®ä¾‹å¯ç›´æ¥æŒ‰éœ€ä¿®æ”¹ IP å’Œè·¯å¾„éƒ¨ç½²ï¼Œç”¨äºæµ‹è¯•æˆ–å°è§„æ¨¡ç”Ÿäº§ç¯å¢ƒã€‚
